<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>بوت خيارات ثنائية متطور - نظام متكامل</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.0.0/dist/browser.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #4e73df;
      --success: #1cc88a;
      --danger: #e74a3b;
      --warning: #f6c23e;
      --dark: #2e384d;
      --light: #f8f9fc;
      --background: #0f172a;
      --card-bg: #1e293b;
      --text: #e2e8f0;
      --telegram: #2AABEE;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Tajawal', sans-serif;
      background: var(--background);
      margin: 0;
      padding: 20px;
      color: var(--text);
      min-height: 100vh;
      direction: rtl;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      border-radius: 15px;
      overflow: hidden;
    }
    
    header {
      background: linear-gradient(120deg, #0c4a6e 0%, #075985 100%);
      padding: 25px 30px;
      text-align: center;
      border-bottom: 5px solid var(--warning);
      position: relative;
    }
    
    .telegram-icon {
      position: absolute;
      top: 20px;
      left: 20px;
      background: var(--telegram);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    
    header h1 {
      font-size: 32px;
      margin-bottom: 10px;
      color: white;
    }
    
    header p {
      opacity: 0.9;
      font-size: 18px;
      max-width: 800px;
      margin: 0 auto;
      color: #e0f2fe;
    }
    
    .anti-detection {
      background: #0c4a6e;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      border-bottom: 1px solid #1e40af;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .anti-detection span {
      background: rgba(220, 38, 38, 0.2);
      padding: 3px 10px;
      border-radius: 20px;
      margin: 0 5px;
      margin-bottom: 5px;
    }
    
    .app-content {
      display: flex;
      min-height: 700px;
      gap: 20px;
      padding: 20px;
    }
    
    .sidebar {
      width: 350px;
      background: var(--card-bg);
      padding: 25px 20px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
    }
    
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .dashboard {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }
    
    .card {
      background: var(--card-bg);
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      transition: transform 0.3s;
      border: 1px solid #334155;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    .card-header {
      background: rgba(30, 41, 59, 0.8);
      padding: 18px 25px;
      border-bottom: 1px solid #334155;
      font-weight: 700;
      color: var(--primary);
      display: flex;
      align-items: center;
      font-size: 18px;
      backdrop-filter: blur(5px);
    }
    
    .card-header i {
      margin-left: 12px;
      font-size: 22px;
    }
    
    .card-body {
      padding: 25px;
    }
    
    .form-group {
      margin-bottom: 25px;
    }
    
    .form-group label {

display: block;
      margin-bottom: 12px;
      font-weight: 600;
      color: var(--text);
      font-size: 16px;
    }
    
    select, input {
      width: 100%;
      padding: 14px 18px;
      border: 1px solid #334155;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
      background: #1f2937;
      color: var(--text);
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }
    
    .flex-group {
      display: flex;
      gap: 20px;
    }
    
    .flex-group .form-group {
      flex: 1;
    }
    
    .btn {
      display: inline-block;
      padding: 16px 28px;
      border-radius: 10px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: all 0.3s;
      text-align: center;
      width: 100%;
      margin-top: 8px;
    }
    
    .btn i {
      margin-left: 10px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-success {
      background: var(--success);
      color: white;
    }
    
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    
    .btn-warning {
      background: var(--warning);
      color: white;
    }
    
    .btn-telegram {
      background: var(--telegram);
      color: white;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .stat-card {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      border-left: 5px solid var(--primary);
      transition: transform 0.3s;
      backdrop-filter: blur(5px);
    }
    
    .stat-card:hover {
      transform: scale(1.03);
    }
    
    .stat-card.win {
      border-left-color: var(--success);
    }
    
    .stat-card.loss {
      border-left-color: var(--danger);
    }
    
    .stat-card.telegram {
      border-left-color: var(--telegram);
    }
    
    .stat-value {
      font-size: 36px;
      font-weight: 800;
      margin: 15px 0;
      color: white;
    }
    
    .stat-title {
      color: #94a3b8;
      font-size: 18px;
      font-weight: 600;
    }
    
    .status-indicator {
      display: inline-block;
      padding: 12px 24px;
      border-radius: 30px;
      font-weight: 700;
      font-size: 17px;
      margin-top: 8px;
    }
    
    .status-active {
      background: rgba(28, 200, 138, 0.15);
      color: var(--success);
      border: 2px solid var(--success);
    }
    
    .status-inactive {
      background: rgba(231, 74, 59, 0.15);
      color: var(--danger);
      border: 2px solid var(--danger);
    }
    
    .status-telegram {
      background: rgba(42, 171, 238, 0.15);
      color: var(--telegram);
      border: 2px solid var(--telegram);
    }
    
    .log-container {
      height: 350px;
      overflow-y: auto;
      background: rgba(15, 23, 42, 0.7);
      border-radius: 10px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      color: #cbd5e0;
      font-size: 15px;
      border: 1px solid #334155;
    }
    
    .log-entry {
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid #334155;
      line-height: 1.7;
      display: flex;
      align-items: center;
    }
    
    .log-time {
      color: #94a3b8;
      margin-right: 15px;
      font-size: 14px;
      min-width: 70px;
    }
    
    .log-info { color: #63b3ed; }

.log-success { color: #68d391; }
    .log-warning { color: #f6e05e; }
    .log-error { color: #fc8181; }
    .log-indicator { color: #a78bfa; }
    .log-filter { color: #67e8f9; }
    .log-telegram { color: #2AABEE; }
    
    .indicator-tag {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin: 5px;
      background: rgba(78, 115, 223, 0.15);
      color: #93c5fd;
      border: 1px solid #3b82f6;
    }
    
    .filter-tag {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin: 5px;
      background: rgba(28, 200, 138, 0.15);
      color: #6ee7b7;
      border: 1px solid #10b981;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid #334155;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .tab {
      padding: 16px 32px;
      cursor: pointer;
      font-weight: 700;
      color: #94a3b8;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
      font-size: 18px;
    }
    
    .tab.active {
      border-bottom: 3px solid var(--primary);
      color: var(--primary);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .strategy-desc {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      border-right: 4px solid var(--primary);
      font-size: 16px;
      line-height: 1.8;
      backdrop-filter: blur(5px);
    }
    
    .strategy-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    
    .strategy-stat {
      flex: 1;
      min-width: 180px;
      padding: 20px;
      background: rgba(30, 64, 175, 0.2);
      border-radius: 10px;
      text-align: center;
      border: 1px solid #3b82f6;
    }
    
    .indicator-card {
      padding: 18px;
      margin: 15px 0;
      background: rgba(30, 41, 59, 0.6);
      border-radius: 10px;
      border-left: 4px solid var(--primary);
      backdrop-filter: blur(5px);
    }
    
    .filter-card {
      padding: 18px;
      margin: 15px 0;
      background: rgba(6, 78, 59, 0.2);
      border-radius: 10px;
      border-left: 4px solid var(--success);
      backdrop-filter: blur(5px);
    }
    
    .performance-chart {
      height: 300px;
      width: 100%;
      margin-top: 20px;
    }
    
    .strategy-section {
      margin-bottom: 35px;
      padding: 25px;
      border-radius: 15px;
      background: var(--card-bg);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      border: 1px solid #334155;
    }
    
    .strategy-header {
      font-size: 24px;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #334155;
    }
    
    .strategy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .strategy-card {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 15px;
      padding: 25px;
      border: 1px solid #334155;
      transition: all 0.3s;
    }
    
    .strategy-card:hover {
      transform: translateY(-10px);
      border-color: var(--primary);
    }
    
    .strategy-card h3 {
      color: var(--primary);
      margin-bottom: 15px;
      font-size: 20px;
    }
    
    .strategy-card ul {
      padding-right: 20px;
      color: #94a3b8;
      line-height: 1.8;
    }
    
    .strategy-card li {
      margin-bottom: 10px;
    }
    
    .platform-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

.platform-card {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      border: 1px solid #334155;
      transition: all 0.3s;
    }
    
    .platform-card:hover {
      transform: scale(1.05);
      border-color: var(--warning);
    }
    
    .platform-card h3 {
      margin-top: 15px;
      color: #e0f2fe;
    }
    
    .indicators-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .indicator-item {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 10px;
      padding: 20px;
      border: 1px solid #334155;
      transition: all 0.3s;
    }
    
    .indicator-item:hover {
      border-color: var(--success);
      transform: translateY(-5px);
    }
    
    .indicator-item h3 {
      color: var(--primary);
      margin-bottom: 10px;
    }
    
    @media (max-width: 1200px) {
      .app-content {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
      }
      
      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .dashboard {
        grid-template-columns: 1fr;
      }
      
      .platform-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .flex-group {
        flex-direction: column;
      }
      
      .platform-grid {
        grid-template-columns: 1fr;
      }
      
      .tab {
        padding: 12px 20px;
        font-size: 16px;
      }
      
      .telegram-icon {
        top: 10px;
        left: 10px;
        width: 40px;
        height: 40px;
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="telegram-icon">✉️</div>
      <h1>بوت خيارات ثنائية متطور</h1>
      <p>نظام تداول آلي متعدد المنصات والاستراتيجيات مع إشعارات تليجرام</p>
    </header>
    
    <div class="anti-detection">
      <span>نظام تجنب الكشف</span>
      <span>توقيت عشوائي</span>
      <span>تغير أنماط التداول</span>
      <span>محاكاة السلوك البشري</span>
      <span>بروكسي متغير</span>
      <span>إشعارات تليجرام</span>
    </div>
    
    <div class="app-content">
      <div class="sidebar">
        <div class="card">
          <div class="card-header">
            <i>⚙️</i> إعدادات البوت الأساسية
          </div>
          <div class="card-body">
            <div class="form-group">
              <label>اختر المنصة:</label>
              <select id="platformSelect">
                <option value="pocketOption">Pocket Option</option>
                <option value="olympTrade">Olymp Trade</option>
                <option value="iqOption">IQ Option</option>
                <option value="expertOption">Expert Option</option>
                <option value="binarycom">Binary.com</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>الأصل:</label>
              <select id="assetSelect">
                <option>EURUSD</option>
                <option>GBPUSD</option>
                <option>USDJPY</option>
                <option>XAUUSD</option>
                <option>BTCUSD</option>
                <option>AUDUSD</option>
                <option>EURJPY</option>
                <option>USDCAD</option>
                <option>GBPJPY</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>الاستراتيجية:</label>
              <select id="strategySelect">
                <option value="priceAction">Price Action + Pin Bar</option>
                <option value="gapStrategy">إستراتيجية الفجوة السعرية</option>

<option value="rsiStrategy">RSI 70/30 + تأكيد شمعة</option>
                <option value="bollingerStrategy">انعكاسات بولينجر باند</option>
                <option value="srStrategy">الدعم/المقاومة + تأكيد</option>
                <option value="emaMacd">EMA 20/50 + MACD</option>
                <option value="newsStrategy">إستراتيجية الأخبار</option>
                <option value="breakoutStrategy">إستراتيجية الاختراق</option>
                <option value="stochStrategy">ستوكاستيك + تأكيد</option>
                <option value="aroonStrategy">إستراتيجية أرون</option>
                <option value="heikenStrategy">انعكاس هيكن آشي</option>
                <option value="volumeStrategy">حجم التداول + حركة السعر</option>
                <option value="engulfingStrategy">شمعة الابتلاع + فلتر ATR</option>
                <option value="doubleConfirm">تأكيد مزدوج (EMA+RSI+شمعة)</option>
              </select>
              <div class="strategy-desc" id="strategyDesc">
                استراتيجية Price Action + Pin Bar: تبحث عن نمط شمعة Pin Bar في حركة السعر مع فلتر حجم التداول
              </div>
            </div>
            
            <div class="flex-group">
              <div class="form-group">
                <label>قيمة الصفقة ($):</label>
                <input id="tradeAmount" type="number" value="10" step="1" min="1">
              </div>
              
              <div class="form-group">
                <label>مدة الصفقة (ثواني):</label>
                <input id="expiryTime" type="number" value="180" step="15" min="30">
              </div>
            </div>
            
            <div class="flex-group">
              <div class="form-group">
                <label>حد الربح اليومي ($):</label>
                <input id="profitLimit" type="number" value="100" step="10" min="20">
              </div>
              
              <div class="form-group">
                <label>حد الخسارة اليومي ($):</label>
                <input id="lossLimit" type="number" value="50" step="10" max="0">
              </div>
            </div>
            
            <div class="form-group">
              <label>توكن بوت التليجرام:</label>
              <input id="telegramToken" type="text" placeholder="أدخل توكن البوت" value="7663877552:AAF8AFuHIympS7THPqDh8QqsgRYSC16DItg">
            </div>
            
            <div class="form-group">
              <label>معرف التليجرام (Chat ID):</label>
              <input id="telegramChatId" type="text" placeholder="@sayed_mohmed أو الرقم" value="@sayed_mohmed">
            </div>
            
            <div class="form-group">
              <button id="testTelegramBtn" class="btn btn-telegram">✉️ اختبار إرسال إشعار</button>
            </div>
            
            <div class="form-group">
              <button id="telegramCheckBtn" class="btn btn-telegram">📡 التحقق من اتصال التليجرام</button>
            </div>
            
            <div class="form-group">
              <button id="startBtn" class="btn btn-success">▶ بدء التداول الآلي</button>
            </div>
            
            <div class="form-group">
              <button id="stopBtn" class="btn btn-danger">⏹ إيقاف البوت</button>
            </div>
            
            <div class="form-group">
              <button id="resetBtn" class="btn btn-warning">↺ إعادة تعيين اليوم</button>
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <i>📊</i> حالة النظام
          </div>
          <div class="card-body">
            <div class="form-group">
              <label>حالة البوت:</label>
              <div class="status-indicator status-inactive" id="botStatus">متوقف</div>
            </div>
            
            <div class="form-group">

<label>الاستراتيجية النشطة:</label>
              <div id="activeStrategy">لا توجد</div>
            </div>
            
            <div class="form-group">
              <label>آخر صفقة:</label>
              <div id="lastTrade">لا توجد صفقات بعد</div>
            </div>
            
            <div class="form-group">
              <label>الأداء العام:</label>
              <div id="performance">0.00%</div>
            </div>
            
            <div class="form-group">
              <label>حالة إشعارات التليجرام:</label>
              <div class="status-indicator" id="telegramStatus">غير نشط</div>
            </div>
            
            <div class="form-group">
              <label>حالة اتصال التليجرام:</label>
              <div class="status-indicator" id="telegramConnectionStatus">غير معروف</div>
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <i>🛡️</i> حماية ضد الكشف
          </div>
          <div class="card-body">
            <div class="form-group">
              <label>وضع التخفي:</label>
              <div class="status-indicator status-active">نشط</div>
            </div>
            
            <div class="form-group">
              <label>التأخير العشوائي:</label>
              <div>4-15 ثانية</div>
            </div>
            
            <div class="form-group">
              <label>البروكسي الحالي:</label>
              <div id="currentProxy">192.168.45.67:8080 (ديناميكي)</div>
            </div>
            
            <div class="form-group">
              <label>نمط التداول:</label>
              <div id="tradingBehavior">شبيه بالبشري (متطور)</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="main-content">
        <div class="tabs">
          <div class="tab active" data-tab="dashboard">لوحة التحكم</div>
          <div class="tab" data-tab="strategies">الاستراتيجيات</div>
          <div class="tab" data-tab="indicators">المؤشرات والفلاتر</div>
          <div class="tab" data-tab="platforms">المنصات المدعومة</div>
        </div>
        
        <div class="tab-content active" id="dashboardTab">
          <div class="stats-grid">
            <div class="stat-card win">
              <div class="stat-title">الأرباح اليومية</div>
              <div class="stat-value" id="dailyProfit">0.00$</div>
              <div>إجمالي الأرباح المحققة</div>
            </div>
            
            <div class="stat-card loss">
              <div class="stat-title">الخسائر اليومية</div>
              <div class="stat-value" id="dailyLoss">0.00$</div>
              <div>إجمالي الخسائر المحققة</div>
            </div>
            
            <div class="stat-card telegram">
              <div class="stat-title">الإشعارات المرسلة</div>
              <div class="stat-value" id="telegramNotifications">0</div>
              <div>عدد إشعارات التليجرام</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-title">الصفقات الناجحة</div>
              <div class="stat-value" id="winTrades">0</div>
              <div>عدد الصفقات الرابحة</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-title">الصفقات الخاسرة</div>
              <div class="stat-value" id="lossTrades">0</div>
              <div>عدد الصفقات الخاسرة</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-title">نسبة النجاح</div>
              <div class="stat-value" id="successRate">0%</div>
              <div>معدل الصفقات الناجحة</div>
            </div>
          </div>
          
          <div class="dashboard">
            <div class="card">
              <div class="card-header">

<i>📈</i> أداء البوت خلال الجلسة
              </div>
              <div class="card-body">
                <div class="performance-chart">
                  <canvas id="performanceChart"></canvas>
                </div>
              </div>
            </div>
            
            <div class="card">
              <div class="card-header">
                <i>📝</i> سجل الأحداث المباشر
              </div>
              <div class="card-body">
                <div class="log-container" id="logContainer">
                  <div class="log-entry">
                    <span class="log-time">12:00:00</span>
                    <span class="log-info">[INFO]</span> تم تحميل البوت بنجاح
                  </div>
                  <div class="log-entry">
                    <span class="log-time">12:00:05</span>
                    <span class="log-indicator">[INDICATOR]</span> تم تحميل 14 استراتيجية و 12 مؤشر
                  </div>
                  <div class="log-entry">
                    <span class="log-time">12:00:10</span>
                    <span class="log-filter">[FILTER]</span> نظام الحماية ضد الكشف نشط
                  </div>
                  <div class="log-entry">
                    <span class="log-time">12:00:15</span>
                    <span class="log-telegram">[TELEGRAM]</span> إشعارات التليجرام جاهزة
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <i>🔄</i> المؤشرات والفلاتر النشطة
            </div>
            <div class="card-body">
              <div class="flex-group">
                <div style="flex: 1;">
                  <h3 style="color: var(--primary); margin-bottom: 15px;">المؤشرات المستخدمة</h3>
                  <div id="activeIndicators">
                    <div class="indicator-tag">RSI (14)</div>
                    <div class="indicator-tag">EMA 20</div>
                    <div class="indicator-tag">MACD</div>
                    <div class="indicator-tag">Bollinger Bands</div>
                    <div class="indicator-tag">ATR (14)</div>
                  </div>
                </div>
                
                <div style="flex: 1;">
                  <h3 style="color: var(--success); margin-bottom: 15px;">الفلاتر المطبقة</h3>
                  <div id="activeFilters">
                    <div class="filter-tag">فلتر حجم التداول</div>
                    <div class="filter-tag">فلتر الأخبار</div>
                    <div class="filter-tag">فلتر الدعم/المقاومة</div>
                    <div class="filter-tag">فلتر ATR</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tab-content" id="strategiesTab">
          <h2 style="color: var(--primary); margin-bottom: 20px;">جميع استراتيجيات التداول</h2>
          
          <div class="strategy-grid">
            <div class="strategy-card">
              <h3>Price Action + Pin Bar</h3>
              <ul>
                <li>تعتمد على شمعة الانعكاس في مناطق الطلب/العرض</li>
                <li>قوية في حالات الارتداد</li>
                <li>المؤشرات: حركة السعر، أشكال الشموع</li>
                <li>الفلاتر: حجم التداول، مناطق SR</li>
              </ul>
            </div>
            
            <div class="strategy-card">
              <h3>إستراتيجية الفجوة السعرية</h3>
              <ul>
                <li>تحليل الفجوة السعرية بين الشموع</li>
                <li>ممتازة بعد افتتاح السوق أو جلسات قوية</li>
                <li>المؤشرات: فجوات السعر، حجم التداول</li>
                <li>الفلاتر: فلتر الزمن، فلتر الأخبار</li>
              </ul>
            </div>

<div class="strategy-card">
              <h3>RSI 70/30 + تأكيد شمعة</h3>
              <ul>
                <li>دخول عند تشبع شرائي/بيعي</li>
                <li>تأكيد بشمعة انعكاس (مثل engulfing)</li>
                <li>المؤشرات: RSI، أشكال الشموع</li>
                <li>الفلاتر: فلتر الحجم، فلتر ATR</li>
              </ul>
            </div>
            
            <div class="strategy-card">
              <h3>انعكاسات بولينجر باند</h3>
              <ul>
                <li>دخول عند لمس أو كسر حدود الباند الخارجي</li>
                <li>تأكيد بالشمعة</li>
                <li>المؤشرات: Bollinger Bands، RSI</li>
                <li>الفلاتر: فلتر الحجم، فلتر الترند</li>
              </ul>
            </div>
            
            <div class="strategy-card">
              <h3>الدعم/المقاومة + تأكيد</h3>
              <ul>
                <li>دخول في مناطق انعكاسية بعد تأكيد شموع</li>
                <li>قوية في الأسواق الجانبية</li>
                <li>المؤشرات: مستويات SR، أشكال الشموع</li>
                <li>الفلاتر: فلتر الحجم، فلتر رفض المناطق</li>
              </ul>
            </div>
            
            <div class="strategy-card">
              <h3>EMA 20/50 + MACD</h3>
              <ul>
                <li>سكالبينج سريع عند تقاطع المتوسطات</li>
                <li>تأكيد بالـ MACD</li>
                <li>المؤشرات: EMA 20, EMA 50, MACD</li>
                <li>الفلاتر: فلتر الترند، فلتر الحجم</li>
              </ul>
            </div>
            
            <div class="strategy-card">
              <h3>إستراتيجية الأخبار</h3>
              <ul>
                <li>تجنب أو الدخول الذكي وقت الأخبار</li>
                <li>فلتر زمني للأحداث المهمة</li>
                <li>المؤشرات: تقويم اقتصادي، التقلب</li>
                <li>الفلاتر: فلتر الزمن، فلتر الأخبار</li>
              </ul>
            </div>
            
            <div class="strategy-card">
              <h3>إستراتيجية الاختراق</h3>
              <ul>
                <li>دخول عند كسر مناطق قوية بزيادة حجم الشمعة</li>
                <li>مثالية في الأسواق الاتجاهية</li>
                <li>المؤشرات: حجم التداول، مناطق الاختراق</li>
                <li>الفلاتر: فلتر الحجم، فلتر الترند</li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="tab-content" id="indicatorsTab">
          <h2 style="color: var(--primary); margin-bottom: 20px;">المؤشرات الفنية والفلاتر</h2>
          
          <div class="card">
            <div class="card-header">
              <i>📊</i> المؤشرات الفنية المستخدمة
            </div>
            <div class="card-body">
              <div class="indicators-grid">
                <div class="indicator-item">
                  <h3>RSI (مؤشر القوة النسبية)</h3>
                  <p>يقيس سرعة واتجاه حركة الأسعار، يستخدم لتحديد حالات التشبع الشرائي والبيعي.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>MACD (المتوسط المتحرك التقاربي/التباعدي)</h3>
                  <p>يقيس العلاقة بين متوسطين متحركين، يستخدم لتحديد اتجاه الترند وقوته.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>EMA (المتوسط المتحرك الأسي)</h3>
                  <p>يعطي وزن أكبر للأسعار الحديثة، يستخدم لتحديد اتجاه الترند ومستويات الدعم/المقاومة.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>ATR (المدى الحقيقي المتوسط)</h3>
                  <p>يقيس تقلب السوق، يستخدم لتحديد نقاط وقف الخسارة وأهداف الربح.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>Aroon Indicator</h3>
                  <p>يحدد بداية ونهاية الاتجاهات، يقيس الوقت منذ أعلى قمة وأدنى قاع.</p>

</div>
                
                <div class="indicator-item">
                  <h3>Bollinger Bands</h3>
                  <p>يتكون من ثلاثة خطوط، يستخدم لتحديد مستويات التشبع والتقلب.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>Stochastic Oscillator</h3>
                  <p>يقارن سعر الإغلاق بنطاق الأسعار خلال فترة زمنية، يستخدم لتحديد نقاط التحول.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>ADX (مؤشر متوسط الحركة الاتجاهية)</h3>
                  <p>يقيس قوة الترند بغض النظر عن اتجاهه، يستخدم لتحديد قوة الاتجاه الحالي.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card" style="margin-top: 20px;">
            <div class="card-header">
              <i>🔍</i> فلاتر التداول
            </div>
            <div class="card-body">
              <div class="indicators-grid">
                <div class="indicator-item">
                  <h3>شمعة التأكيد</h3>
                  <p>يشمل Pin Bar, Engulfing, Doji للتأكد من إشارات الانعكاس.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>الدعم والمقاومة</h3>
                  <p>التداول فقط في مناطق الدعم والمقاومة الرئيسية.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>فوليوم سبايك</h3>
                  <p>التداول فقط عند زيادة حجم التداول عن المتوسط.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>مناطق الاختراق</h3>
                  <p>التداول فقط عند اختراق مستويات رئيسية.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>فلتر الأخبار</h3>
                  <p>تجنب التداول خلال الأحداث الإخبارية المهمة.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>اتجاه عام</h3>
                  <p>التداول فقط في اتجاه الترند الرئيسي.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>فلتر ATR</h3>
                  <p>التداول فقط عندما يكون التقلب كافياً.</p>
                </div>
                
                <div class="indicator-item">
                  <h3>حجم شمعة فوق المتوسط</h3>
                  <p>التداول فقط عند وجود شمعة كبيرة الحجم.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="tab-content" id="platformsTab">
          <h2 style="color: var(--primary); margin-bottom: 20px;">المنصات المدعومة</h2>
          
          <div class="platform-grid">
            <div class="platform-card">
              <div style="font-size: 48px; color: #4ade80;">PO</div>
              <h3>Pocket Option</h3>
              <p>مدعوم بالكامل مع نظام تجنب الكشف</p>
            </div>
            
            <div class="platform-card">
              <div style="font-size: 48px; color: #f87171;">OT</div>
              <h3>Olymp Trade</h3>
              <p>مدعوم بالكامل مع حماية متقدمة</p>
            </div>
            
            <div class="platform-card">
              <div style="font-size: 48px; color: #60a5fa;">IQ</div>
              <h3>IQ Option</h3>
              <p>مدعوم بنظام التخفي المتقدم</p>
            </div>
            
            <div class="platform-card">
              <div style="font-size: 48px; color: #fbbf24;">EO</div>
              <h3>Expert Option</h3>
              <p>مدعوم مع تغيير أنماط التداول</p>
            </div>
          </div>
          
          <div class="card" style="margin-top: 20px;">
            <div class="card-header">

<i>🛡️</i> نظام الحماية ضد الكشف
            </div>
            <div class="card-body">
              <h3 style="color: var(--warning); margin-bottom: 20px;">كيف يعمل نظام تجنب الحظر</h3>
              
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div class="indicator-card">
                  <h4>توقيت عشوائي</h4>
                  <p>يغير البوت فترات التداول بشكل عشوائي بين 3-45 ثانية لمحاكاة السلوك البشري.</p>
                </div>
                
                <div class="indicator-card">
                  <h4>تغيير البروكسي</h4>
                  <p>يستخدم البوت قائمة بروكسيات ديناميكية تتغير كل ساعة لإخفاء الهوية.</p>
                </div>
                
                <div class="indicator-card">
                  <h4>أنماط تداول متغيرة</h4>
                  <p>يغير البوت استراتيجيات التداول بشكل دوري لمنع اكتشاف الأنماط.</p>
                </div>
                
                <div class="indicator-card">
                  <h4>محرك سلوك بشري</h4>
                  <p>يقلد البوت سلوكيات المستخدمين البشر مثل الأخطاء والتردد في بعض القرارات.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  // ============== النظام الأساسي ==============
  const BinaryBot = (function() {
    // الحالة الداخلية
    let state = {
      running: false,
      platform: 'pocketOption',
      strategy: 'priceAction',
      asset: 'EURUSD',
      tradeAmount: 10,
      expiryTime: 180,
      profitLimit: 100,
      lossLimit: -50,
      telegramToken: '7663877552:AAF8AFuHIympS7THPqDh8QqsgRYSC16DItg',
      telegramChatId: '@sayed_mohmed',
      telegramEnabled: false,
      telegramNotifications: 0,
      telegramConnected: false,
      
      // الإحصائيات
      stats: {
        dailyProfit: 0,
        dailyLoss: 0,
        winTrades: 0,
        lossTrades: 0,
        totalTrades: 0,
        performance: 0,
        lastSignal: null,
        lastTrade: null
      },
      
      // بيانات السوق
      marketData: {
        candles: [],
        currentPrice: 1.1250,
        highPrices: [],
        lowPrices: [],
        closePrices: [],
        volumes: []
      },
      
      // المؤقتات
      intervals: {
        dataCollection: null,
        tradingCycle: null
      },
      
      // المؤشرات والفلاتر
      activeIndicators: [],
      activeFilters: [],
      
      // السجل
      logs: [],
      
      // نظام الحماية
      protection: {
        lastTradeTime: 0,
        proxyList: ['192.168.45.67:8080', '203.34.56.78:3128', '176.89.12.34:8080'],
        currentProxy: '192.168.45.67:8080',
        behaviorPatterns: ['normal', 'aggressive', 'cautious'],
        currentBehavior: 'normal',
        userAgents: [
          'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
          'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.1 Safari/605.1.15',
          'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36'
        ],
        currentUserAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
      }
    };
    
    // إرسال إشعار تليجرام
    function sendTelegramNotification(message) {
      if (!state.telegramToken || !state.telegramChatId) {
        this.log('لم يتم تعيين إعدادات التليجرام', 'warning');
        return;
      }
      
      // تنظيف معرف التليجرام من أي @
      const cleanedChatId = state.telegramChatId.replace(/^@/, '');
      
      const url = https://api.telegram.org/bot${state.telegramToken}/sendMessage;

const params = {
        chat_id: cleanedChatId,
        text: message
      };
      
      // إرسال الطلب باستخدام fetch
      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(params)
      })
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          state.telegramNotifications++;
          this.log('تم إرسال إشعار التليجرام بنجاح', 'telegram');
        } else {
          this.log(فشل إرسال إشعار التليجرام: ${data.description}, 'error');
        }
      })
      .catch(error => {
        this.log(خطأ في إرسال إشعار التليجرام: ${error.message}, 'error');
      });
    }
    
    // التحقق من اتصال التليجرام
    function checkTelegramConnection() {
      if (!state.telegramToken || !state.telegramChatId) {
        this.log('لم يتم تعيين إعدادات التليجرام', 'warning');
        state.telegramConnected = false;
        return;
      }
      
      const url = https://api.telegram.org/bot${state.telegramToken}/getMe;
      
      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data.ok) {
            state.telegramConnected = true;
            this.log('تم التحقق من اتصال التليجرام بنجاح', 'telegram');
          } else {
            state.telegramConnected = false;
            this.log(فشل التحقق من اتصال التليجرام: ${data.description}, 'error');
          }
        })
        .catch(error => {
          state.telegramConnected = false;
          this.log(خطأ في التحقق من اتصال التليجرام: ${error.message}, 'error');
        });
    }
    
    // استراتيجيات التداول
    const strategies = {
      priceAction: function() {
        // تطبيق الفلاتر
        if (!this.applyFilter('volumeFilter')) return null;
        if (!this.applyFilter('srFilter')) return null;
        
        // حساب المؤشرات
        const lastCandle = state.marketData.candles[state.marketData.candles.length - 1];
        if (!lastCandle) return null;
        
        const bodySize = Math.abs(lastCandle.close - lastCandle.open);
        const totalRange = lastCandle.high - lastCandle.low;
        const isPinBar = bodySize < totalRange * 0.3;
        
        if (isPinBar) {
          const direction = lastCandle.close > lastCandle.open ? 'CALL' : 'PUT';
          
          // تسجيل المؤشرات المستخدمة
          this.recordIndicator('Price Action', 'تحليل حركة السعر');
          this.recordIndicator('Pin Bar', 'نمط شمعة البين بار');
          
          return { 
            strategy: 'priceAction', 
            direction, 
            confidence: 0.75 
          };
        }
        return null;
      },
      
      gapStrategy: function() {
        if (!this.applyFilter('timeFilter')) return null;
        
        if (state.marketData.candles.length < 2) return null;
        
        const prevCandle = state.marketData.candles[state.marketData.candles.length - 2];
        const lastCandle = state.marketData.candles[state.marketData.candles.length - 1];
        
        const gapUp = lastCandle.low > prevCandle.high;
        const gapDown = lastCandle.high < prevCandle.low;
        
        if (gapUp) {
          this.recordIndicator('Gap Up', 'فجوة صعودية');
          return { strategy: 'gapStrategy', direction: 'CALL', confidence: 0.7 };
        } else if (gapDown) {
          this.recordIndicator('Gap Down', 'فجوة هبوطية');
          return { strategy: 'gapStrategy', direction: 'PUT', confidence: 0.7 };
        }
        return null;
      },
      
      rsiStrategy: function() {
        if (!this.applyFilter('volumeFilter')) return null;
        
        const rsi = this.calculateRSI(14);
        const lastCandle = state.marketData.candles[state.marketData.candles.length - 1];

if (rsi < 30 && lastCandle.close > lastCandle.open) {
          this.recordIndicator('RSI', rsi);
          return { strategy: 'rsiStrategy', direction: 'CALL', confidence: 0.8 };
        } else if (rsi > 70 && lastCandle.close < lastCandle.open) {
          this.recordIndicator('RSI', rsi);
          return { strategy: 'rsiStrategy', direction: 'PUT', confidence: 0.8 };
        }
        return null;
      },
      
      bollingerStrategy: function() {
        if (!this.applyFilter('volatilityFilter')) return null;
        
        const bb = this.calculateBollingerBands();
        const price = state.marketData.currentPrice;
        
        if (price > bb.upper) {
          this.recordIndicator('Bollinger Bands', 'سعر فوق النطاق العلوي');
          return { strategy: 'bollingerStrategy', direction: 'PUT', confidence: 0.75 };
        } else if (price < bb.lower) {
          this.recordIndicator('Bollinger Bands', 'سعر تحت النطاق السفلي');
          return { strategy: 'bollingerStrategy', direction: 'CALL', confidence: 0.75 };
        }
        return null;
      },
      
      // يمكن إضافة المزيد من الاستراتيجيات هنا
    };
    
    // فلاتر التداول
    const filters = {
      volumeFilter: function() {
        const currentVolume = state.marketData.volumes.slice(-1)[0] || 0;
        const avgVolume = state.marketData.volumes.slice(-14).reduce((a, b) => a + b, 0) / 14;
        
        return currentVolume > avgVolume * 1.2;
      },
      
      srFilter: function() {
        // محاكاة فلتر الدعم/المقاومة
        return Math.random() > 0.3; // 70% من الوقت
      },
      
      volatilityFilter: function() {
        const atr = this.calculateATR(14);
        return atr > 0.0005;
      },
      
      timeFilter: function() {
        // تجنب أوقات الأخبار المهمة
        const now = new Date();
        const hours = now.getHours();
        return hours < 14 || hours > 18; // تجنب توقيت نشر الأخبار
      },
      
      newsFilter: function() {
        // محاكاة تجنب أوقات الأخبار
        return Math.random() > 0.2; // 80% من الوقت
      }
    };
    
    // الوظائف العامة
    return {
      start: function() {
        if (state.running) return;
        this.log('تم بدء البوت بنجاح', 'info');
        
        // بدء جمع بيانات السوق
        this.startDataCollection();
        
        // بدء دورة التداول
        state.intervals.tradingCycle = setInterval(() => {
          this.evaluateMarket();
        }, this.getRandomDelay());
        
        state.running = true;
        state.activeIndicators = [];
        state.activeFilters = [];
        
        // إرسال إشعار بدء البوت
        if (state.telegramToken && state.telegramChatId) {
          const startMsg = ✅ تم بدء البوت بنجاح!
المنصة: ${state.platform}
الأصل: ${state.asset}
الاستراتيجية: ${state.strategy}
قيمة الصفقة: ${state.tradeAmount}$;
          sendTelegramNotification.call(this, startMsg);
        }
      },
      
      stop: function() {
        if (!state.running) return;
        
        // إيقاف المؤقتات
        clearInterval(state.intervals.dataCollection);
        clearInterval(state.intervals.tradingCycle);
        
        state.running = false;
        this.log('تم إيقاف البوت', 'warning');
        
        // إرسال إشعار إيقاف البوت
        if (state.telegramToken && state.telegramChatId) {
          const stopMsg = ⛔ تم إيقاف البوت
الأرباح اليومية: ${state.stats.dailyProfit.toFixed(2)}$
الخسائر اليومية: ${state.stats.dailyLoss.toFixed(2)}$
الصفقات الناجحة: ${state.stats.winTrades}
الصفقات الخاسرة: ${state.stats.lossTrades};
          sendTelegramNotification.call(this, stopMsg);
        }
      },
      
      getRandomDelay: function() {
        // تأخير عشوائي بين 3 إلى 45 ثانية
        return Math.floor(Math.random() * 42000) + 3000;

},
      
      rotateProxy: function() {
        // تغيير البروكسي بشكل عشوائي
        const newProxy = state.protection.proxyList[
          Math.floor(Math.random() * state.protection.proxyList.length)
        ];
        state.protection.currentProxy = newProxy;
        this.log(تم تغيير البروكسي إلى: ${newProxy}, 'info');
        
        // تغيير User Agent
        const newUserAgent = state.protection.userAgents[
          Math.floor(Math.random() * state.protection.userAgents.length)
        ];
        state.protection.currentUserAgent = newUserAgent;
        this.log(تم تغيير User Agent إلى: ${newUserAgent.substring(0, 30)}..., 'info');
      },
      
      startDataCollection: function() {
        state.intervals.dataCollection = setInterval(() => {
          this.collectPriceData();
        }, 1000);
        
        this.log('بدأ جمع بيانات السوق', 'info');
      },
      
      collectPriceData: function() {
        // محاكاة تغير الأسعار
        const priceChange = (Math.random() - 0.5) * 0.001;
        state.marketData.currentPrice = parseFloat((state.marketData.currentPrice + priceChange).toFixed(5));
        
        // إضافة سعر جديد
        state.marketData.ticks = state.marketData.ticks || [];
        state.marketData.ticks.push(state.marketData.currentPrice);
        
        // بناء الشموع كل دقيقة
        const now = new Date();
        if (now.getSeconds() === 0) {
          this.buildCandle();
        }
      },
      
      buildCandle: function() {
        if (!state.marketData.ticks || state.marketData.ticks.length === 0) return;
        
        const ticks = state.marketData.ticks;
        const candle = {
          open: ticks[0],
          high: Math.max(...ticks),
          low: Math.min(...ticks),
          close: ticks[ticks.length - 1],
          volume: Math.floor(Math.random() * 1000000) + 500000,
          timestamp: new Date()
        };
        
        // تحديث بيانات المؤشرات
        state.marketData.candles.push(candle);
        state.marketData.highPrices.push(candle.high);
        state.marketData.lowPrices.push(candle.low);
        state.marketData.closePrices.push(candle.close);
        state.marketData.volumes.push(candle.volume);
        
        if (state.marketData.candles.length > 100) {
          state.marketData.candles.shift();
          state.marketData.highPrices.shift();
          state.marketData.lowPrices.shift();
          state.marketData.closePrices.shift();
          state.marketData.volumes.shift();
        }
        
        state.marketData.ticks = [];
        this.log(تم إنشاء شمعة جديدة: ${candle.open.toFixed(5)} -> ${candle.close.toFixed(5)}, 'info');
      },
      
      evaluateMarket: function() {
        if (state.marketData.candles.length < 20) {
          this.log('لا توجد بيانات كافية لتحليل السوق', 'warning');
          return;
        }
        
        // تغيير البروكسي بشكل دوري
        if (Math.random() > 0.8) this.rotateProxy();
        
        // إعادة تعيين المؤشرات والفلاتر النشطة
        state.activeIndicators = [];
        state.activeFilters = [];
        
        // تطبيق الاستراتيجية المختارة
        const strategyFunc = strategies[state.strategy];
        if (!strategyFunc) {
          this.log(استراتيجية غير معروفة: ${state.strategy}, 'error');
          return;
        }
        
        const signal = strategyFunc.call(this);
        
        if (signal) {
          state.stats.lastSignal = signal;
          this.executeTrade(signal);
        }
        
        // تغيير وقت التأخير للصفقة التالية
        clearInterval(state.intervals.tradingCycle);
        state.intervals.tradingCycle = setInterval(() => {
          this.evaluateMarket();
        }, this.getRandomDelay());
      },
      
      executeTrade: function(signal) {

// محاكاة تنفيذ الصفقة
        const success = Math.random() > 0.35; // 65% success rate
        const profit = success ? state.tradeAmount * 0.8 : -state.tradeAmount;
        
        // تحديث الإحصائيات
        state.stats.totalTrades++;
        
        if (success) {
          state.stats.dailyProfit += profit;
          state.stats.winTrades += 1;
          // إصلاح حساب النسبة عند الصفر
          state.stats.performance = state.stats.totalTrades > 0 
            ? (state.stats.winTrades / state.stats.totalTrades) * 100 
            : 0;
          this.log(صفقة ${signal.direction} ناجحة: +${(state.tradeAmount * 0.8).toFixed(2)}$, 'success');
        } else {
          state.stats.dailyLoss += Math.abs(profit);
          state.stats.lossTrades += 1;
          // إصلاح حساب النسبة عند الصفر
          state.stats.performance = state.stats.totalTrades > 0 
            ? (state.stats.winTrades / state.stats.totalTrades) * 100 
            : 0;
          this.log(صفقة ${signal.direction} خاسرة: -${state.tradeAmount.toFixed(2)}$, 'error');
        }
        
        // تسجيل الصفقة
        state.stats.lastTrade = {
          time: new Date(),
          asset: state.asset,
          direction: signal.direction,
          amount: state.tradeAmount,
          expiry: state.expiryTime,
          profit: profit,
          success: success,
          strategy: signal.strategy
        };
        
        // إرسال إشعار التليجرام
        if (state.telegramToken && state.telegramChatId) {
          const tradeMsg = 📊 صفقة ${signal.direction} ${success ? 'ناجحة' : 'خاسرة'}!
الأصل: ${state.asset}
المبلغ: ${state.tradeAmount}$
المكسب: ${profit.toFixed(2)}$
الاستراتيجية: ${signal.strategy};
          sendTelegramNotification.call(this, tradeMsg);
        }
        
        // التحقق من الحدود اليومية
        this.checkDailyLimits();
      },
      
      calculateRSI: function(period = 14) {
        const closes = state.marketData.closePrices;
        return technicalindicators.RSI.calculate({values: closes, period}).pop();
      },
      
      calculateBollingerBands: function() {
        const closes = state.marketData.closePrices;
        const bb = technicalindicators.BollingerBands.calculate({
          values: closes,
          period: 20,
          stdDev: 2
        }).pop();
        return bb;
      },
      
      calculateATR: function(period = 14) {
        const highs = state.marketData.highPrices;
        const lows = state.marketData.lowPrices;
        const closes = state.marketData.closePrices;
        return technicalindicators.ATR.calculate({
          high: highs,
          low: lows,
          close: closes,
          period
        }).pop();
      },
      
      recordIndicator: function(name, value) {
        state.activeIndicators.push({ name, value });
      },
      
      recordFilter: function(name, status) {
        state.activeFilters.push({ name, status });
      },
      
      applyFilter: function(filterName) {
        const filterFunc = filters[filterName];
        if (!filterFunc) {
          this.log(فلتر غير معروف: ${filterName}, 'error');
          return false;
        }
        return filterFunc.call(this);
      },
      
      checkDailyLimits: function() {
        if (state.stats.dailyProfit >= state.profitLimit) {
          this.log(تم الوصول إلى حد الربح اليومي (${state.profitLimit}$), 'warning');
          this.stop();
        }
        
        if (state.stats.dailyLoss >= Math.abs(state.lossLimit)) {
          this.log(تم الوصول إلى حد الخسارة اليومي (${Math.abs(state.lossLimit)}$), 'error');
          this.stop();
        }
      },
      
      resetStats: function() {
        state.stats = {
          dailyProfit: 0,
          dailyLoss: 0,
          winTrades: 0,
          lossTrades: 0,

totalTrades: 0,
          performance: 0,
          lastSignal: null,
          lastTrade: null
        };
        
        this.log('تم إعادة تعيين إحصائيات اليوم', 'info');
        
        // إرسال إشعار إعادة التعيين
        if (state.telegramToken && state.telegramChatId) {
          sendTelegramNotification.call(this, '🔄 تم إعادة تعيين إحصائيات اليوم');
        }
      },
      
      updateSettings: function(settings) {
        Object.assign(state, settings);
        this.log('تم تحديث إعدادات البوت', 'info');
        
        // حفظ التوكن في localStorage
        if (settings.telegramToken) {
          localStorage.setItem('telegramToken', settings.telegramToken);
        }
        if (settings.telegramChatId) {
          localStorage.setItem('telegramChatId', settings.telegramChatId);
        }
      },
      
      log: function(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        state.logs.push({ timestamp, message, type });
      },
      
      testTelegram: function() {
        if (!state.telegramToken || !state.telegramChatId) {
          this.log('لم يتم تعيين إعدادات التليجرام', 'warning');
          return;
        }
        
        const testMsg = '📩 هذا إشعار اختبار من بوت التداول!';
        sendTelegramNotification.call(this, testMsg);
        this.log('تم إرسال إشعار اختبار إلى التليجرام', 'telegram');
      },
      
      getState: function() {
        return state;
      },
      
      checkTelegramConnection: function() {
        checkTelegramConnection.call(this);
      }
    };
  })();

  // ============== واجهة المستخدم ==============
  const UI = (function() {
    // تهيئة الواجهة
    function init() {
      setupEventListeners();
      loadSettings();
      updateUI();
      setupTabs();
      setupStrategyDescriptions();
      initCharts();
      
      // سجل أولي
      BinaryBot.log('جاهز للبدء، يرجى ضبط الإعدادات والضغط على "بدء التداول الآلي"');
      BinaryBot.log('إشعارات التليجرام جاهزة', 'telegram');
    }
    
    function initCharts() {
      const ctx = document.getElementById('performanceChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00'],
          datasets: [{
            label: 'الأرباح',
            data: [0, 12, 25, 18, 40, 55, 70],
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.3,
            fill: true
          }, {
            label: 'الخسائر',
            data: [0, 5, 8, 15, 10, 12, 15],
            borderColor: '#ef4444',
            backgroundColor: 'rgba(239, 68, 68, 0.1)',
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                color: '#e2e8f0'
              }
            }
          },
          scales: {
            y: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: '#94a3b8'
              }
            },
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: '#94a3b8'
              }
            }
          }
        }
      });
    }
    
    // تحميل الإعدادات من localStorage
    function loadSettings() {
      const savedToken = localStorage.getItem('telegramToken');
      const savedChatId = localStorage.getItem('telegramChatId');
      
      if (savedToken) {
        document.getElementById('telegramToken').value = savedToken;
      }
      if (savedChatId) {
        document.getElementById('telegramChatId').value = savedChatId;

}
    }
    
    // إعداد مستمعي الأحداث
    function setupEventListeners() {
      document.getElementById('startBtn').addEventListener('click', startBot);
      document.getElementById('stopBtn').addEventListener('click', stopBot);
      document.getElementById('resetBtn').addEventListener('click', resetStats);
      document.getElementById('testTelegramBtn').addEventListener('click', testTelegram);
      document.getElementById('telegramCheckBtn').addEventListener('click', checkTelegram);
      
      // تحديث الإعدادات عند التغيير
      document.getElementById('platformSelect').addEventListener('change', updateSettings);
      document.getElementById('assetSelect').addEventListener('change', updateSettings);
      document.getElementById('strategySelect').addEventListener('change', updateSettings);
      document.getElementById('tradeAmount').addEventListener('change', updateSettings);
      document.getElementById('expiryTime').addEventListener('change', updateSettings);
      document.getElementById('profitLimit').addEventListener('change', updateSettings);
      document.getElementById('lossLimit').addEventListener('change', updateSettings);
      document.getElementById('telegramToken').addEventListener('change', updateSettings);
      document.getElementById('telegramChatId').addEventListener('change', updateSettings);
    }
    
    // إعداد التبويبات
    function setupTabs() {
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          // إزالة النشاط من جميع التبويبات
          tabs.forEach(t => t.classList.remove('active'));
          
          // إخفاء جميع محتويات التبويبات
          document.querySelectorAll('.tab-content').forEach(c => {
            c.classList.remove('active');
          });
          
          // إضافة النشاط للتبويب المحدد
          this.classList.add('active');
          
          // إظهار محتوى التبويب المحدد
          const tabName = this.getAttribute('data-tab');
          document.getElementById(${tabName}Tab).classList.add('active');
        });
      });
    }
    
    // أوصاف الاستراتيجيات
    function setupStrategyDescriptions() {
      const strategySelect = document.getElementById('strategySelect');
      const strategyDesc = document.getElementById('strategyDesc');
      
      const descriptions = {
        priceAction: 'استراتيجية Price Action + Pin Bar: تبحث عن نمط شمعة Pin Bar في حركة السعر مع فلتر حجم التداول',
        gapStrategy: 'إستراتيجية الفجوة السعرية: تحليل الفجوة السعرية بين الشموع، ممتازة بعد افتتاح السوق',
        rsiStrategy: 'RSI 70/30 + تأكيد شمعة: دخول عند تشبع شرائي/بيعي مع تأكيد شمعة انعكاس',
        bollingerStrategy: 'انعكاسات بولينجر باند: دخول عند لمس أو كسر حدود الباند الخارجي',
        srStrategy: 'الدعم/المقاومة + تأكيد: دخول في مناطق انعكاسية بعد تأكيد شموع',
        emaMacd: 'EMA 20/50 + MACD: سكالبينج سريع عند تقاطع المتوسطات وتأكيد بالـ MACD',
        newsStrategy: 'إستراتيجية الأخبار: تجنب أو الدخول الذكي وقت الأخبار مع فلتر زمني',
        breakoutStrategy: 'إستراتيجية الاختراق: دخول عند كسر مناطق قوية بزيادة حجم الشمعة',
        stochStrategy: 'ستوكاستيك + تأكيد: دخول عند عبور 80/20 في الاستوكاستك مع تأكيد',
        aroonStrategy: 'إستراتيجية أرون: تحليل بداية ونهاية الاتجاه باستخدام مؤشر أرون',
        heikenStrategy: 'انعكاس هيكن آشي: تغير لون شموع هيكن آشي بعد ترند قوي',
        volumeStrategy: 'حجم التداول + حركة السعر: دخول بعد شموع ذات فوليوم ضخم مع إشارة انعكاسية',
        engulfingStrategy: 'شمعة الابتلاع + فلتر ATR: شمعة engulfing قوية مع تأكيد بقيمة ATR',
        doubleConfirm: 'تأكيد مزدوج: إشارتين من المؤشرات + تأكيد شمعة لدخول دقيق جدًا'
      };
      
      strategySelect.addEventListener('change', function() {
        strategyDesc.textContent = descriptions[this.value] || 'لا يوجد وصف لهذه الاستراتيجية';

});
    }
    
    // بدء البوت
    function startBot() {
      // تحديث الإعدادات أولاً
      updateSettings();
      
      // بدء البوت
      BinaryBot.start();
      
      // تحديث الواجهة
      updateUI();
    }
    
    // إيقاف البوت
    function stopBot() {
      BinaryBot.stop();
      updateUI();
    }
    
    // إعادة تعيين الإحصائيات
    function resetStats() {
      BinaryBot.resetStats();
      updateUI();
    }
    
    // اختبار إشعار التليجرام
    function testTelegram() {
      updateSettings();
      BinaryBot.testTelegram();
      updateUI();
    }
    
    // التحقق من اتصال التليجرام
    function checkTelegram() {
      updateSettings();
      BinaryBot.checkTelegramConnection();
      updateUI();
    }
    
    // تحديث الإعدادات
    function updateSettings() {
      const settings = {
        platform: document.getElementById('platformSelect').value,
        asset: document.getElementById('assetSelect').value,
        strategy: document.getElementById('strategySelect').value,
        tradeAmount: parseFloat(document.getElementById('tradeAmount').value),
        expiryTime: parseInt(document.getElementById('expiryTime').value),
        profitLimit: parseFloat(document.getElementById('profitLimit').value),
        lossLimit: parseFloat(document.getElementById('lossLimit').value),
        telegramToken: document.getElementById('telegramToken').value,
        telegramChatId: document.getElementById('telegramChatId').value
      };
      
      BinaryBot.updateSettings(settings);
    }
    
    // تحديث واجهة المستخدم
    function updateUI() {
      const state = BinaryBot.getState();
      
      // حالة البوت
      const statusEl = document.getElementById('botStatus');
      statusEl.textContent = state.running ? 'نشط' : 'متوقف';
      statusEl.className = state.running ? 'status-indicator status-active' : 'status-indicator status-inactive';
      
      // الاستراتيجية النشطة
      document.getElementById('activeStrategy').textContent = state.strategy;
      
      // آخر صفقة
      const lastTradeEl = document.getElementById('lastTrade');
      if (state.stats.lastTrade) {
        const trade = state.stats.lastTrade;
        const resultClass = trade.success ? 'log-success' : 'log-error';
        lastTradeEl.innerHTML = ${trade.direction} - ${trade.amount}$ - <span class="${resultClass}">${trade.profit.toFixed(2)}$</span>;
      } else {
        lastTradeEl.textContent = 'لا توجد صفقات بعد';
      }
      
      // الأداء العام
      document.getElementById('performance').textContent = state.stats.performance.toFixed(2) + '%';
      
      // الإحصائيات
      document.getElementById('dailyProfit').textContent = state.stats.dailyProfit.toFixed(2) + '$';
      document.getElementById('dailyLoss').textContent = state.stats.dailyLoss.toFixed(2) + '$';
      document.getElementById('winTrades').textContent = state.stats.winTrades;
      document.getElementById('lossTrades').textContent = state.stats.lossTrades;
      document.getElementById('successRate').textContent = state.stats.performance.toFixed(2) + '%';
      document.getElementById('telegramNotifications').textContent = state.telegramNotifications;
      
      // حالة التليجرام
      const telegramStatusEl = document.getElementById('telegramStatus');
      const telegramEnabled = state.telegramToken && state.telegramChatId;
      telegramStatusEl.textContent = telegramEnabled ? 'نشط' : 'غير نشط';
      telegramStatusEl.className = telegramEnabled ? 'status-indicator status-telegram' : 'status-indicator status-inactive';
      
      // حالة اتصال التليجرام
      const telegramConnectionEl = document.getElementById('telegramConnectionStatus');
      if (state.telegramConnected) {
        telegramConnectionEl.textContent = 'متصل';
        telegramConnectionEl.className = 'status-indicator status-telegram';

} else {
        telegramConnectionEl.textContent = 'غير متصل';
        telegramConnectionEl.className = 'status-indicator status-inactive';
      }
      
      // البروكسي الحالي
      document.getElementById('currentProxy').textContent = state.protection.currentProxy;
      
      // سجل الأحداث
      updateLogs();
    }
    
    // تحديث سجل الأحداث
    function updateLogs() {
      const state = BinaryBot.getState();
      const logContainer = document.getElementById('logContainer');
      logContainer.innerHTML = '';
      
      state.logs.slice().reverse().slice(0, 20).forEach(log => {
        const logEntry = document.createElement('div');
        logEntry.className = 'log-entry';
        
        const logClass = log-${log.type};
        const time = log.timestamp || new Date().toLocaleTimeString();
        
        logEntry.innerHTML = 
          <span class="log-time">${time}</span>
          <span class="${logClass}">[${log.type.toUpperCase()}]</span> 
          ${log.message}
        ;
        
        logContainer.appendChild(logEntry);
      });
    }
    
    return {
      init,
      updateUI
    };
  })();

  // بدء التطبيق عند تحميل الصفحة
  document.addEventListener('DOMContentLoaded', function() {
    UI.init();
    
    // تحديث واجهة المستخدم بانتظام
    setInterval(() => {
      UI.updateUI();
    }, 2000);
  });
  </script>
</body>
</html>